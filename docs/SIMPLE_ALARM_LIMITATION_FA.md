# ⚠️ محدودیت مهم سیستم آلارم

## 🔴 محدودیت اصلی

سیستم آلارم این برنامه از **`SimpleAlarmService`** استفاده می‌کند که بر پایه **Dart Timer** است.

### این یعنی چه؟

آلارم‌ها **فقط وقتی برنامه باز است** (در حالت foreground) کار می‌کنند.

## ✅ زمان‌هایی که آلارم کار می‌کند

| حالت                                  | وضعیت آلارم   |
| ------------------------------------- | ------------- |
| 🟢 برنامه باز و در حال استفاده        | ✅ کار می‌کند |
| 🟢 برنامه در recent apps (background) | ✅ کار می‌کند |
| 🟢 صفحه قفل اما برنامه باز            | ✅ کار می‌کند |

## ❌ زمان‌هایی که آلارم کار نمی‌کند

| حالت                             | وضعیت آلارم                        |
| -------------------------------- | ---------------------------------- |
| 🔴 برنامه force close شده        | ❌ کار نمی‌کند                     |
| 🔴 برنامه از recent apps پاک شده | ❌ کار نمی‌کند                     |
| 🔴 گوشی restart شده              | ❌ کار نمی‌کند (تا برنامه باز شود) |
| 🔴 برنامه توسط سیستم kill شده    | ❌ کار نمی‌کند                     |

## 🎯 چرا این طراحی انتخاب شد؟

### مزایا ✅

1. **ساده و سبک**: بدون نیاز به package های سنگین
2. **بدون مجوز خاص**: نیازی به مجوز نوتیفیکیشن نیست
3. **تجربه کاربری عالی**: صفحه تمام‌صفحه + صدا
4. **سریع**: بدون تاخیر، فوری فعال می‌شود
5. **کنترل کامل**: طراحی UI کاملاً سفارشی

### معایب ❌

1. **نیاز به برنامه باز**: باید برنامه در background باشد
2. **وابسته به سیستم**: ممکن است سیستم برنامه را kill کند

## 💡 راه‌حل‌های موقت

### برای استفاده موثر:

1. **برنامه را در Recent Apps نگه دارید**

   - برنامه را نبندید، فقط دکمه Home بزنید
   - از Recent Apps پاک نکنید

2. **تنظیمات باتری را تغییر دهید**

   ```
   Settings > Battery > App battery usage
   Self Management → Unrestricted
   ```

3. **Autostart را فعال کنید** (Xiaomi, Huawei, OPPO)

   ```
   Settings > Apps > Autostart
   Self Management → ON
   ```

4. **Lock کردن در Recent Apps**

   - در Recent Apps روی آیکون قفل کلیک کنید
   - این از kill شدن جلوگیری می‌کند

5. **Background restrictions را غیرفعال کنید**
   ```
   Settings > Apps > Self Management > Battery
   → No restrictions
   ```

## 🔮 راه‌حل دائمی (آینده)

برای اینکه آلارم در **تمام شرایط** کار کند، نیاز به استفاده از یکی از این راه‌حل‌ها است:

### Option 1: Android Alarm Manager Plus

```yaml
dependencies:
  android_alarm_manager_plus: ^3.0.0
```

- ✅ آلارم در background کار می‌کند
- ✅ بعد از restart هم کار می‌کند
- ❌ پیچیده‌تر برای پیاده‌سازی
- ❌ نیاز به configuration خاص

### Option 2: Flutter Local Notifications

```yaml
dependencies:
  flutter_local_notifications: ^17.0.0
```

- ✅ نوتیفیکیشن با fullScreenIntent
- ✅ در background کار می‌کند
- ❌ نیاز به مجوزهای خاص
- ❌ تجربه کاربری کمتر (نوتیفیکیشن → صفحه)

### Option 3: WorkManager

```yaml
dependencies:
  workmanager: ^0.5.0
```

- ✅ reliable برای background tasks
- ✅ سازگار با Android Doze
- ❌ برای periodic tasks بهتر است
- ❌ timing دقیق ندارد

## 📊 مقایسه

| ویژگی        | SimpleAlarmService (فعلی) | Alarm Manager | Notification |
| ------------ | ------------------------- | ------------- | ------------ |
| سادگی        | ⭐⭐⭐⭐⭐                | ⭐⭐          | ⭐⭐⭐       |
| Background   | ❌                        | ✅            | ✅           |
| تجربه کاربری | ⭐⭐⭐⭐⭐                | ⭐⭐⭐⭐      | ⭐⭐⭐       |
| مجوزها       | نیاز ندارد                | متوسط         | زیاد         |
| دقت زمانی    | ⭐⭐⭐⭐⭐                | ⭐⭐⭐⭐      | ⭐⭐⭐⭐     |

## 🎓 نکات مهم

### برای کاربران

1. **برنامه را باز نگه دارید**

   - در background باشد، نه close شده

2. **تنظیمات Battery را چک کنید**

   - Unrestricted battery usage
   - Autostart enabled

3. **Don't kill my app!**
   - بعضی گوشی‌ها (Xiaomi, Huawei) aggressive هستند
   - تنظیمات خاص نیاز دارند

### برای توسعه‌دهندگان

اگر می‌خواهید background support اضافه کنید:

```dart
// 1. اضافه کردن package
dependencies:
  android_alarm_manager_plus: ^3.0.0

// 2. پیاده‌سازی
import 'package:android_alarm_manager_plus/android_alarm_manager_plus.dart';

// 3. Schedule alarm
await AndroidAlarmManager.oneShot(
  duration,
  alarmId,
  callbackFunction,
  exact: true,
  wakeup: true,
);
```

## ❓ سوالات متداول

### Q: چرا آلارم من فعال نشد؟

**A:** احتمالاً برنامه بسته شده. برنامه را باز کنید و در background نگه دارید.

### Q: آیا می‌توانم گوشی را restart کنم؟

**A:** بعد از restart، باید برنامه را یک بار باز کنید تا آلارم‌ها reschedule شوند.

### Q: چطور مطمئن شوم آلارم کار می‌کند؟

**A:** برنامه را باز کنید، آلارم تست (2 دقیقه) بسازید، دکمه Home بزنید (نبندید!)، صبر کنید.

### Q: آیا در آینده background support اضافه می‌شود؟

**A:** بله! در نسخه‌های بعدی این قابلیت اضافه خواهد شد.

## 🚀 خلاصه

این برنامه برای **استفاده روزمره** و **یادآوری‌های کوتاه‌مدت** عالی است:

✅ **مناسب برای:**

- یادآوری‌های 5-30 دقیقه‌ای
- استفاده حین کار با گوشی
- زمانی که برنامه باز است

❌ **نامناسب برای:**

- آلارم‌های چند ساعته
- وقتی گوشی خاموش است
- آلارم صبح (sleep timer)

---

**نکته:** اگر نیاز به آلارم مطمئن در background دارید، لطفاً از برنامه‌های مخصوص آلارم (مثل Google Clock) استفاده کنید یا منتظر نسخه بعدی بمانید! 🙏

---

**نسخه:** 5.0 (Simple Alarm Only)  
**تاریخ:** اکتبر 2025  
**وضعیت:** ✅ کار می‌کند در foreground/background (برنامه باز)
