# ุฑุงูููุง ุฑูุน ูุดฺฉู ููุชูฺฉุดู ู ุขูุงุฑู

## ูุดฺฉูุงุช ฺฉู ุจุฑุทุฑู ุดุฏ โ

### ฑ. ููุชูฺฉุดู ุฒูุงูโุจูุฏ ููุดุฏ

**ูุดฺฉู:** ููุช ฺฉ ุชุณฺฉ ุง ูุฏู ุจุง ุงุฏุขูุฑ ุงุถุงูู ูฺฉุฑุฏุฏุ ููุท ุชุณฺฉ/ูุฏู ุฐุฎุฑู ูุดุฏ ุงูุง notification ุงุตูุงู ุฒูุงูโุจูุฏ ููุดุฏ.

**ุฑุงู ุญู:**

- ฺฉุฏ ุงุถุงูู ุดุฏู ุฏุฑ `add_edit_task_screen.dart` ู `add_edit_goal_screen.dart`
- ุญุงูุง ุจุนุฏ ุงุฒ ุฐุฎุฑู ุชุณฺฉ/ูุฏูุ notification ูู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุฒูุงูโุจูุฏ ูุดู

### ฒ. Duplicate Notifications

**ูุดฺฉู:** ููุช ฺฉ ุชุณฺฉ/ูุฏู ุฑู ูุฑุงุด ูฺฉุฑุฏุฏุ ุงุฏุขูุฑ ุฌุฏุฏ ุงุถุงูู ูุดุฏ ุจุฏูู ุงูฺฉู ุงุฏุขูุฑ ูุจู ุญุฐู ุจุดู.

**ุฑุงู ุญู:**

- ุงูู ุงุฏุขูุฑูุง ูุจู ุญุฐู ูุดู
- ุจุนุฏ ุงุฏุขูุฑ ุฌุฏุฏ ุงุถุงูู ูุดู

### ณ. ุจุฑูุงูู crash ูฺฉุฑุฏ

**ูุดฺฉู:** ููุช ุฒูุงู ุขูุงุฑู ูุฑุณุฏุ ุจุฑูุงูู crash ูฺฉุฑุฏ ุง ุจุณุชู ูุดุฏ.

**ุฏูุงู ุงุญุชูุงู:**

1. **Custom sound path ุงุดุชุจุงู ุจูุฏ:** ุงุณุชูุงุฏู ุงุฒ `UriAndroidNotificationSound` ูุงุฒ ุจู ูุณุฑ ุฎุงุต ุฏุงุฑู ฺฉู ุจุงุฏ ุฏุฑ `AndroidManifest.xml` ุชุนุฑู ุจุดู
2. **Callback ุฏุฑ background ฺฉุงุฑ ููฺฉุฑุฏ:** ููุช app ุจุณุชู ุงุณุชุ callback ูุง ูุนููู ฺฉุงุฑ ููฺฉูู

**ุฑุงู ุญู:**

- ูุนูุงู ุงุฒ ุตุฏุง ูพุดโูุฑุถ ุณุณุชู ุงุณุชูุงุฏู ูฺฉูู
- ฺฉ ุตูุญู Alarm Screen ุงุถุงูู ุดุฏู ฺฉู ููุช ุฑู notification ฺฉูฺฉ ูฺฉูุฏ ุจุงุฒ ูุดู
- ุงูฺฉุงู Dismiss ู Snooze ุขูุงุฑู ุงุถุงูู ุดุฏู

## ฺุทูุฑ ฺฉุงุฑ ูฺฉูู โจ

### ฑ. ุฒูุงูโุจูุฏ ุขูุงุฑู

```dart
// ููุช ฺฉ ุชุณฺฉ ุจุง ุงุฏุขูุฑ ุงุถุงูู ูฺฉูุฏ:
await reminderProvider.addReminder(
  itemId: newTask.id,
  type: ReminderType.task,
  scheduledDateTime: _reminderDateTime!,
  title: 'ุงุฏุขูุฑ ูุธูู: ${newTask.title}',
  body: newTask.description,
  alarmSoundPath: alarmSoundPath,
);

// ุงู ฺฉุฏ ฺฉ notification ุฒูุงูโุจูุฏ ูฺฉูู
```

### ฒ. ููุช ุฒูุงู ุขูุงุฑู ูุฑุณู

1. **ููุชูฺฉุดู ููุงุด ุฏุงุฏู ูุดู** ุจุง ุตุฏุง ุณุณุชู
2. **ููุช ุฑู notification ฺฉูฺฉ ูฺฉูุฏ:**
   - ุจุฑูุงูู ุจุงุฒ ูุดู (ุงฺฏุฑ ุจุณุชู ุจูุฏ)
   - ุตูุญู Alarm Screen ููุงุด ุฏุงุฏู ูุดู
   - ูุชููุฏ ุขูุงุฑู ุฑู Dismiss ุง Snooze ฺฉูุฏ

### ณ. Snooze

- ููุช ุขูุงุฑู ุฑู Snooze ูฺฉูุฏุ ุจุฑุง ต ุฏููู ุฏฺฏู ุฒูุงูโุจูุฏ ูุดู
- ูุชููุฏ ฺูุฏู ุจุงุฑ Snooze ฺฉูุฏ

## ูุญุฏูุฏุชโูุง ู ูฺฉุงุช ููู ๐

### ฑ. ุตุฏุง Custom

**ูุนูุงู:** ุงุฒ ุตุฏุง ูพุดโูุฑุถ ุณุณุชู ุงุณุชูุงุฏู ูุดู

**ฺุฑุงุ** ุงุณุชูุงุฏู ุงุฒ ุตุฏุง custom ุฏุฑ runtime ูุงุฒ ุจู ุงู ฺฉุงุฑูุง ุฏุงุฑู:

1. ูุงู ุตุฏุง ุจุงุฏ ุฏุฑ ูพูุดู `android/app/src/main/res/raw/` ุจุงุดู
2. ุจุงุฏ ุฏุฑ ุฒูุงู build ุงุถุงูู ุจุดู (ููุดู runtime ุงุถุงูู ฺฉุฑุฏ)
3. ูุงุฒ ุจู rebuild ฺฉุงูู app ุฏุงุฑู

**ุฑุงู ุญู ุขูุฏู:** ูุชููู ฺฉ ุณุณุชู ูพุดุฑูุชูโุชุฑ ุจุง `android_alarm_manager` ุง `flutter_alarm` ูพุงุฏู ฺฉูู ฺฉู:

- ุตุฏุง custom ุฑู ูพุฎุด ฺฉูู
- ุจู ุตูุฑุช loop ูพุฎุด ุจุดู
- ุญุช ููุช app ุจุณุชู ุงุณุช ฺฉุงุฑ ฺฉูู

### ฒ. App ุฏุฑ Background

**ูุถุนุช ูุนู:**

- โ ููุชูฺฉุดู ููุงุด ุฏุงุฏู ูุดู
- โ ุตุฏุง ุณุณุชู ูพุฎุด ูุดู
- โ ููุช ุฑู notification ฺฉูฺฉ ฺฉูุฏุ ุตูุญู Alarm ุจุงุฒ ูุดู

**ูุญุฏูุฏุช:**

- ุตุฏุง ููุท ฺฉุจุงุฑ ูพุฎุด ูุดู (loop ูุณุช)
- ููุดู ุตุฏุง ุฑู ุงุฒ ุฏุงุฎู app ูุชููู ฺฉุฑุฏ (ฺูู ุณุณุชู ูพุฎุด ูฺฉูู)

### ณ. ุชูุธูุงุช ุจุงุชุฑ

**ููู:** ุจุฑุง ุงุทููุงู ุงุฒ ฺฉุงุฑฺฉุฑุฏ ุขูุงุฑู:

**Android:**

1. Settings > Apps > Self Management > Battery
2. ุงูุชุฎุงุจ "Unrestricted" ุง "No restrictions"
3. ุฏุฑ ุจุฑุฎ ฺฏูุดโูุง (Xiaomi, Huawei):
   - Autostart ุฑุง ูุนุงู ฺฉูุฏ
   - Background restrictions ุฑุง ุบุฑูุนุงู ฺฉูุฏ

## ุชุณุช ุขูุงุฑู ๐งช

### ุชุณุช ุณุฑุน

1. ฺฉ ุชุณฺฉ ุง ูุฏู ุฌุฏุฏ ุจุณุงุฒุฏ
2. ุงุฏุขูุฑ ุฑุง ุจุฑุง ฒ ุฏููู ุจุนุฏ ุชูุธู ฺฉูุฏ
3. ุฐุฎุฑู ฺฉูุฏ
4. ููุชุธุฑ ุจูุงูุฏ

**ูุชุฌู ููุฑุฏ ุงูุชุธุงุฑ:**

- ุจุนุฏ ุงุฒ ฒ ุฏูููุ ููุชูฺฉุดู ููุงุด ุฏุงุฏู ูุดู
- ุตุฏุง ุณุณุชู ูพุฎุด ูุดู
- ุจุง ฺฉูฺฉ ุฑู notificationุ ุตูุญู Alarm ุจุงุฒ ูุดู
- ูุชููุฏ Dismiss ุง Snooze ฺฉูุฏ

### ุชุณุช ุฏุฑ Background

1. ฺฉ ุขูุงุฑู ุจุฑุง ฒ ุฏููู ุจุนุฏ ุชูุธู ฺฉูุฏ
2. ุจุฑูุงูู ุฑู ุจุจูุฏุฏ (home button ุง recent apps)
3. ููุชุธุฑ ุจูุงูุฏ

**ูุชุฌู ููุฑุฏ ุงูุชุธุงุฑ:**

- ููุชูฺฉุดู ููุงุด ุฏุงุฏู ูุดู
- ุตุฏุง ูพุฎุด ูุดู
- ุจุง ฺฉูฺฉุ ุจุฑูุงูู ู ุตูุญู Alarm ุจุงุฒ ูุดู

### ุชุณุช App Killed

1. ฺฉ ุขูุงุฑู ุจุฑุง ต ุฏููู ุจุนุฏ ุชูุธู ฺฉูุฏ
2. ุจุฑูุงูู ุฑู Force Stop ฺฉูุฏ (Settings > Apps > Force Stop)
3. ููุชุธุฑ ุจูุงูุฏ

**ูุชุฌู ููุฑุฏ ุงูุชุธุงุฑ:**

- ููุชูฺฉุดู ููุงุด ุฏุงุฏู ูุดู
- ุตุฏุง ูพุฎุด ูุดู
- ุจุง ฺฉูฺฉุ ุจุฑูุงูู ุงุฒ ุงูู ุจุงุฒ ูุดู ู ุตูุญู Alarm ููุงุด ุฏุงุฏู ูุดู

## ูุงูโูุง ุชุบุฑ ุงูุชู ๐

### Core Services

- โ `lib/core/services/notification_service.dart` - ุงุถุงูู ุดุฏู callback ู payload
- โ `lib/core/services/alarm_service.dart` - ุจุฏูู ุชุบุฑ (ุจุฑุง ุงุณุชูุงุฏู ุขูุฏู)

### Repositories

- โ `lib/data/repositories/reminder_repository.dart` - ุงุถุงูู ุดุฏู reminderId ุจู notifications

### Screens

- โ `lib/presentation/screens/tasks/add_edit_task_screen.dart` - ุงุตูุงุญ ููุทู ุฐุฎุฑู ู ุงุฏุขูุฑ
- โ `lib/presentation/screens/goals/add_edit_goal_screen.dart` - ุงุตูุงุญ ููุทู ุฐุฎุฑู ู ุงุฏุขูุฑ
- โ `lib/presentation/screens/alarm/alarm_notification_screen.dart` - **ุฌุฏุฏ** - ุตูุญู ููุงุด ุขูุงุฑู

### Main

- โ `lib/main.dart` - ุงุถุงูู ุดุฏู callback handler ู navigatorKey

## ูุฑุงุญู ุจุนุฏ (ุงุฎุชุงุฑ) ๐

ุงฺฏุฑ ูุฎูุงุฏ ุขูุงุฑู ููโุชุฑ ู ุญุฑููโุงโุชุฑ ุฏุงุดุชู ุจุงุดุฏ:

### ฺฏุฒูู ฑ: ุงุณุชูุงุฏู ุงุฒ flutter_alarm

```yaml
dependencies:
  flutter_alarm: ^1.0.0
```

**ูุฒุงุง:**

- ุตุฏุง custom ุจู ุตูุฑุช loop
- ฺฉุงุฑ ูฺฉูู ุญุช ููุช app killed ุงุณุช
- UI ูุงุจู ุชูุธู

### ฺฏุฒูู ฒ: ุงุณุชูุงุฏู ุงุฒ android_alarm_manager_plus

```yaml
dependencies:
  android_alarm_manager_plus: ^3.0.0
```

**ูุฒุงุง:**

- ฺฉูุชุฑู ฺฉุงูู ุฑู ุฒูุงูโุจูุฏ
- ุงุฌุฑุง ฺฉุฏ ุฏุฑ background
- ููุงุณุจ ุจุฑุง ุขูุงุฑูโูุง ุชฺฉุฑุงุฑ

### ฺฏุฒูู ณ: ุชุฑฺฉุจ ุจุง Foreground Service

**ูุฒุงุง:**

- ฺฉูุชุฑู ฺฉุงูู ุฑู ูพุฎุด ุตุฏุง
- ุงูฺฉุงู loop ู stop
- ููุงุด notification ููุดู ุฑู ุตูุญู

## ูพุดุชุจุงู ๐ฌ

ุงฺฏุฑ ูููุฒ ูุดฺฉู ุฏุงุฑุฏ:

1. **ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ:**

   ```bash
   flutter run
   ```

   ุจู ุฏูุจุงู ุฎุทุงูุง ุจุง tag `NotificationService` ุง `AlarmService` ุจฺฏุฑุฏุฏ

2. **ูุฌูุฒูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ:**

   - Notification permission
   - Exact alarm permission
   - Battery restrictions

3. **ุจุฑูุงูู ุฑุง rebuild ฺฉูุฏ:**

   ```bash
   flutter clean
   flutter pub get
   flutter run
   ```

4. **ูุณุฎู Android ุฑุง ุจุฑุฑุณ ฺฉูุฏ:**
   - Android 12+ ูุงุฒ ุจู ูุฌูุฒ `SCHEDULE_EXACT_ALARM` ุฏุงุฑุฏ
   - Android 13+ ูุงุฒ ุจู ูุฌูุฒ `POST_NOTIFICATIONS` ุฏุงุฑุฏ

## ุชุบุฑุงุช ูุณุจุช ุจู ูุณุฎู ูุจู

### ูุจู โ

- ููุชูฺฉุดู ุฒูุงูโุจูุฏ ููุดุฏ
- Duplicate notifications
- ุจุฑูุงูู crash ูฺฉุฑุฏ
- UI ุจุฑุง ุขูุงุฑู ูุฏุงุดุช

### ุจุนุฏ โ

- ููุชูฺฉุดู ุฏุฑุณุช ุฒูุงูโุจูุฏ ูุดู
- ุงุฏุขูุฑูุง ูุจู ุญุฐู ูุดู
- ุจุฑูุงูู crash ููฺฉูู
- ุตูุญู Alarm ุฒุจุง ู ฺฉุงุฑุจุฑุฏ
- ุงูฺฉุงู Snooze
- ฺฉุงุฑ ูฺฉูู ุฏุฑ background ู ุญุช app killed

---

**ุชุงุฑุฎ ุขูพุฏุช:** 2025-10-13
**ูุณุฎู:** 2.0.0
